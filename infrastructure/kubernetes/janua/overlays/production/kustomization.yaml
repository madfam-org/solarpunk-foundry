# Production Overlay Kustomization
# ================================
# Production-specific configuration for auth.madfam.io
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: janua-production

# Namespace for all resources
namespace: janua

# Inherit from base
resources:
  - ../../base

# Production-specific patches
patches:
  # ConfigMap patch for OIDC issuer and CORS
  - path: configmap-patch.yaml
    target:
      kind: ConfigMap
      name: janua-config

  # Deployment patch for RS256 keys
  - path: deployment-patch.yaml
    target:
      kind: Deployment
      name: janua-api

# Image configuration - pin to specific version in production
images:
  - name: ghcr.io/madfam-io/janua-api
    # Use specific version tag, not 'latest'
    # Update this when deploying new versions
    newTag: v20260109-053146-d15e420

# Labels for production (metadata only, not selectors)
labels:
  - pairs:
      environment: production
      app.kubernetes.io/instance: production
    includeSelectors: false

# Common annotations
commonAnnotations:
  janua.dev/managed-by: "kustomize"
  janua.dev/environment: "production"
  janua.dev/issuer: "https://auth.madfam.io"

# Replicas for production (can override base)
replicas:
  - name: janua-api
    count: 1  # Increase for HA: 2-3 replicas
